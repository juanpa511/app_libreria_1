{"ast":null,"code":"import apiService from './apiService';\nconst loanService = {\n  // Obtener préstamos del usuario actual\n  getMyLoans: async () => {\n    try {\n      const userEmail = apiService.getUserEmail();\n      if (!userEmail) {\n        throw new Error('Usuario no autenticado');\n      }\n      const response = await apiService.getBookingsByEmail(userEmail);\n      return response;\n    } catch (error) {\n      throw new Error('Error al obtener mis préstamos: ' + error.message);\n    }\n  },\n  // Obtener todos los préstamos (Admin)\n  getAllLoans: async () => {\n    try {\n      const response = await apiService.getAllLoans();\n      return response;\n    } catch (error) {\n      throw new Error('Error al obtener préstamos: ' + error.message);\n    }\n  },\n  // Crear nuevo préstamo (Admin)\n  createLoan: async loanData => {\n    try {\n      const response = await apiService.createBooking(loanData);\n      return response;\n    } catch (error) {\n      throw new Error('Error al crear préstamo: ' + error.message);\n    }\n  },\n  // Solicitar préstamo (Lector)\n  requestLoan: async bookId => {\n    try {\n      const response = await apiService.requestBooking(bookId);\n      return response;\n    } catch (error) {\n      throw new Error('Error al solicitar préstamo: ' + error.message);\n    }\n  },\n  // Devolver libro\n  returnLoan: async bookingId => {\n    try {\n      // Para admin, necesitamos obtener el email del usuario del préstamo\n      // Primero obtenemos todos los préstamos para encontrar el email del usuario\n      const allLoans = await apiService.getAllLoans();\n      const loan = allLoans.find(l => l.idBooking === bookingId);\n      if (!loan || !loan.user || !loan.user.email) {\n        throw new Error('No se pudo encontrar el usuario del préstamo');\n      }\n      const returnData = {\n        idBooking: bookingId\n      };\n      const response = await apiService.returnBook(loan.user.email, returnData);\n      return response;\n    } catch (error) {\n      throw new Error('Error al devolver libro: ' + error.message);\n    }\n  },\n  // Renovar préstamo\n  renewLoan: async loanId => {\n    try {\n      const response = await apiService.renewBooking(loanId);\n      return response;\n    } catch (error) {\n      throw new Error('Error al renovar préstamo: ' + error.message);\n    }\n  },\n  // Cancelar préstamo\n  cancelLoan: async loanId => {\n    try {\n      const response = await apiService.cancelBooking(loanId);\n      return response;\n    } catch (error) {\n      throw new Error('Error al cancelar préstamo: ' + error.message);\n    }\n  },\n  // Obtener préstamos por usuario (Admin)\n  getLoansByUser: async userEmail => {\n    try {\n      const response = await apiService.getBookingsByEmail(userEmail);\n      return response;\n    } catch (error) {\n      throw new Error('Error al obtener préstamos del usuario: ' + error.message);\n    }\n  },\n  // Obtener préstamos vencidos (filtrar en frontend)\n  getOverdueLoans: async () => {\n    try {\n      const allLoans = await apiService.getAllLoans();\n      const now = new Date();\n      return allLoans.filter(loan => loan.state && new Date(loan.dateReturn) < now);\n    } catch (error) {\n      throw new Error('Error al obtener préstamos vencidos: ' + error.message);\n    }\n  }\n};\nexport default loanService;","map":{"version":3,"names":["apiService","loanService","getMyLoans","userEmail","getUserEmail","Error","response","getBookingsByEmail","error","message","getAllLoans","createLoan","loanData","createBooking","requestLoan","bookId","requestBooking","returnLoan","bookingId","allLoans","loan","find","l","idBooking","user","email","returnData","returnBook","renewLoan","loanId","renewBooking","cancelLoan","cancelBooking","getLoansByUser","getOverdueLoans","now","Date","filter","state","dateReturn"],"sources":["C:/Users/jpval/OneDrive/Desktop/jp/aplicaciones web/app_libreria_1/Frontend/src/services/loanService.js"],"sourcesContent":["import apiService from './apiService';\r\n\r\nconst loanService = {\r\n  // Obtener préstamos del usuario actual\r\n  getMyLoans: async () => {\r\n    try {\r\n      const userEmail = apiService.getUserEmail();\r\n      if (!userEmail) {\r\n        throw new Error('Usuario no autenticado');\r\n      }\r\n      const response = await apiService.getBookingsByEmail(userEmail);\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al obtener mis préstamos: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Obtener todos los préstamos (Admin)\r\n  getAllLoans: async () => {\r\n    try {\r\n      const response = await apiService.getAllLoans();\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al obtener préstamos: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Crear nuevo préstamo (Admin)\r\n  createLoan: async (loanData) => {\r\n    try {\r\n      const response = await apiService.createBooking(loanData);\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al crear préstamo: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Solicitar préstamo (Lector)\r\n  requestLoan: async (bookId) => {\r\n    try {\r\n      const response = await apiService.requestBooking(bookId);\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al solicitar préstamo: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Devolver libro\r\n  returnLoan: async (bookingId) => {\r\n    try {\r\n      // Para admin, necesitamos obtener el email del usuario del préstamo\r\n      // Primero obtenemos todos los préstamos para encontrar el email del usuario\r\n      const allLoans = await apiService.getAllLoans();\r\n      const loan = allLoans.find(l => l.idBooking === bookingId);\r\n      \r\n      if (!loan || !loan.user || !loan.user.email) {\r\n        throw new Error('No se pudo encontrar el usuario del préstamo');\r\n      }\r\n      \r\n      const returnData = { idBooking: bookingId };\r\n      const response = await apiService.returnBook(loan.user.email, returnData);\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al devolver libro: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Renovar préstamo\r\n  renewLoan: async (loanId) => {\r\n    try {\r\n      const response = await apiService.renewBooking(loanId);\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al renovar préstamo: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Cancelar préstamo\r\n  cancelLoan: async (loanId) => {\r\n    try {\r\n      const response = await apiService.cancelBooking(loanId);\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al cancelar préstamo: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Obtener préstamos por usuario (Admin)\r\n  getLoansByUser: async (userEmail) => {\r\n    try {\r\n      const response = await apiService.getBookingsByEmail(userEmail);\r\n      return response;\r\n    } catch (error) {\r\n      throw new Error('Error al obtener préstamos del usuario: ' + error.message);\r\n    }\r\n  },\r\n\r\n  // Obtener préstamos vencidos (filtrar en frontend)\r\n  getOverdueLoans: async () => {\r\n    try {\r\n      const allLoans = await apiService.getAllLoans();\r\n      const now = new Date();\r\n      return allLoans.filter(loan => \r\n        loan.state && new Date(loan.dateReturn) < now\r\n      );\r\n    } catch (error) {\r\n      throw new Error('Error al obtener préstamos vencidos: ' + error.message);\r\n    }\r\n  }\r\n};\r\n\r\nexport default loanService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}