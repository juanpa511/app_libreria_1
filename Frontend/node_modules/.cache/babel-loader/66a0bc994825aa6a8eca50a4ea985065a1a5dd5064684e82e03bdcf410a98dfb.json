{"ast":null,"code":"import apiService from './apiService';\nconst loanService = {\n  // Obtener préstamos del usuario actual\n  getMyLoans: async () => {\n    try {\n      const userEmail = apiService.getUserEmail();\n      if (!userEmail) {\n        throw new Error('Usuario no autenticado');\n      }\n      const url = `http://localhost:8087/api/booking/find/${userEmail}`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Error al obtener préstamos');\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      throw new Error('Error al obtener mis préstamos: ' + error.message);\n    }\n  },\n  // Obtener todos los préstamos (Admin)\n  getAllLoans: async () => {\n    try {\n      const response = await apiService.getAllLoans();\n      return response;\n    } catch (error) {\n      throw new Error('Error al obtener préstamos: ' + error.message);\n    }\n  },\n  // Crear nuevo préstamo (Admin)\n  createLoan: async loanData => {\n    try {\n      const response = await apiService.createBooking(loanData);\n      return response;\n    } catch (error) {\n      throw new Error('Error al crear préstamo: ' + error.message);\n    }\n  },\n  // Devolver libro\n  returnLoan: async bookingId => {\n    try {\n      // Para admin, necesitamos obtener el email del usuario del préstamo\n      // Primero obtenemos todos los préstamos para encontrar el email del usuario\n      const allLoans = await apiService.getAllLoans();\n      const loan = allLoans.find(l => l.idBooking === bookingId);\n      if (!loan || !loan.user || !loan.user.email) {\n        throw new Error('No se pudo encontrar el usuario del préstamo');\n      }\n      const returnData = {\n        idBooking: bookingId\n      };\n      const response = await apiService.returnBook(loan.user.email, returnData);\n      return response;\n    } catch (error) {\n      throw new Error('Error al devolver libro: ' + error.message);\n    }\n  },\n  // Renovar préstamo\n  renewLoan: async loanId => {\n    try {\n      const response = await apiService.renewBooking(loanId);\n      return response;\n    } catch (error) {\n      throw new Error('Error al renovar préstamo: ' + error.message);\n    }\n  },\n  // Cancelar préstamo\n  cancelLoan: async loanId => {\n    try {\n      const response = await apiService.cancelBooking(loanId);\n      return response;\n    } catch (error) {\n      throw new Error('Error al cancelar préstamo: ' + error.message);\n    }\n  },\n  // Obtener préstamos por usuario (Admin)\n  getLoansByUser: async userEmail => {\n    try {\n      const response = await apiService.getBookingsByEmail(userEmail);\n      return response;\n    } catch (error) {\n      throw new Error('Error al obtener préstamos del usuario: ' + error.message);\n    }\n  },\n  // Obtener préstamos vencidos (filtrar en frontend)\n  getOverdueLoans: async () => {\n    try {\n      const allLoans = await apiService.getAllLoans();\n      const now = new Date();\n      return allLoans.filter(loan => loan.state && new Date(loan.dateReturn) < now);\n    } catch (error) {\n      throw new Error('Error al obtener préstamos vencidos: ' + error.message);\n    }\n  }\n};\nexport default loanService;","map":{"version":3,"names":["apiService","loanService","getMyLoans","userEmail","getUserEmail","Error","url","response","fetch","ok","data","json","error","message","getAllLoans","createLoan","loanData","createBooking","returnLoan","bookingId","allLoans","loan","find","l","idBooking","user","email","returnData","returnBook","renewLoan","loanId","renewBooking","cancelLoan","cancelBooking","getLoansByUser","getBookingsByEmail","getOverdueLoans","now","Date","filter","state","dateReturn"],"sources":["C:/Users/jpval/OneDrive/Desktop/jp/aplicaciones web/app_libreria_1/Frontend/src/services/loanService.js"],"sourcesContent":["import apiService from './apiService';\n\nconst loanService = {\n  // Obtener préstamos del usuario actual\n  getMyLoans: async () => {\n    try {\n      const userEmail = apiService.getUserEmail();\n      if (!userEmail) {\n        throw new Error('Usuario no autenticado');\n      }\n      const url = `http://localhost:8087/api/booking/find/${userEmail}`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Error al obtener préstamos');\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      throw new Error('Error al obtener mis préstamos: ' + error.message);\n    }\n  },\n\n  // Obtener todos los préstamos (Admin)\n  getAllLoans: async () => {\n    try {\n      const response = await apiService.getAllLoans();\n      return response;\n    } catch (error) {\n      throw new Error('Error al obtener préstamos: ' + error.message);\n    }\n  },\n\n  // Crear nuevo préstamo (Admin)\n  createLoan: async (loanData) => {\n    try {\n      const response = await apiService.createBooking(loanData);\n      return response;\n    } catch (error) {\n      throw new Error('Error al crear préstamo: ' + error.message);\n    }\n  },\n\n  // Devolver libro\n  returnLoan: async (bookingId) => {\n    try {\n      // Para admin, necesitamos obtener el email del usuario del préstamo\n      // Primero obtenemos todos los préstamos para encontrar el email del usuario\n      const allLoans = await apiService.getAllLoans();\n      const loan = allLoans.find(l => l.idBooking === bookingId);\n      \n      if (!loan || !loan.user || !loan.user.email) {\n        throw new Error('No se pudo encontrar el usuario del préstamo');\n      }\n      \n      const returnData = { idBooking: bookingId };\n      const response = await apiService.returnBook(loan.user.email, returnData);\n      return response;\n    } catch (error) {\n      throw new Error('Error al devolver libro: ' + error.message);\n    }\n  },\n\n  // Renovar préstamo\n  renewLoan: async (loanId) => {\n    try {\n      const response = await apiService.renewBooking(loanId);\n      return response;\n    } catch (error) {\n      throw new Error('Error al renovar préstamo: ' + error.message);\n    }\n  },\n\n  // Cancelar préstamo\n  cancelLoan: async (loanId) => {\n    try {\n      const response = await apiService.cancelBooking(loanId);\n      return response;\n    } catch (error) {\n      throw new Error('Error al cancelar préstamo: ' + error.message);\n    }\n  },\n\n  // Obtener préstamos por usuario (Admin)\n  getLoansByUser: async (userEmail) => {\n    try {\n      const response = await apiService.getBookingsByEmail(userEmail);\n      return response;\n    } catch (error) {\n      throw new Error('Error al obtener préstamos del usuario: ' + error.message);\n    }\n  },\n\n  // Obtener préstamos vencidos (filtrar en frontend)\n  getOverdueLoans: async () => {\n    try {\n      const allLoans = await apiService.getAllLoans();\n      const now = new Date();\n      return allLoans.filter(loan => \n        loan.state && new Date(loan.dateReturn) < now\n      );\n    } catch (error) {\n      throw new Error('Error al obtener préstamos vencidos: ' + error.message);\n    }\n  }\n};\n\nexport default loanService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}